<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>NX-Hacking</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="temp_style.css" />
</head>
<body>
<h1 id="hacking-and-extending-nx-a-comprehensive-guide">Hacking and
Extending NX: A Comprehensive Guide</h1>
<h2 id="introduction">Introduction</h2>
<p>NX (Next Scripting Language) is built on top of NSF (Next Scripting
Framework), making it highly extensible. This guide shows you how to
hack, modify, and extend NX using NSF’s meta-programming
capabilities.</p>
<h2 id="core-extension-points">1. Core Extension Points</h2>
<h3 id="method-system-extensions">Method System Extensions</h3>
<h4 id="custom-method-types">Custom Method Types</h4>
<p>Method types in NX/NSF define how methods are created and executed.
Each method type has its own creation command and execution semantics.
The method type system allows you to extend NX with new kinds of
methods.</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode tcl"><code class="sourceCode tcl"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new method type for async methods</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>::nsf::methodtype::<span class="ot">create</span> async <span class="kw">{</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    -createCmd <span class="kw">{</span><span class="ot">name</span> argList <span class="ot">body</span><span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">set</span> wrapper <span class="kw">[string</span> <span class="ot">map</span> <span class="kw">[list</span> %<span class="ot">body</span>% <span class="dt">$body</span> %<span class="ot">name</span>% <span class="dt">$name</span><span class="kw">]</span> <span class="kw">{</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>            coroutine %<span class="ot">name</span>%_cor apply <span class="kw">{{</span><span class="ot">name</span> <span class="ot">body</span><span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>                yield</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>                <span class="kw">uplevel</span> <span class="dv">1</span> <span class="dt">$body</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>            <span class="kw">}}</span> %<span class="ot">name</span>% %<span class="ot">body</span>%</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}]</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> <span class="dt">$wrapper</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>How it works: 1. <code>::nsf::methodtype::create</code> registers a
new method type with NSF 2. The <code>-createCmd</code> option specifies
how methods of this type are created 3. The command receives: -
<code>name</code>: The method name being created - <code>argList</code>:
The argument list for the method - <code>body</code>: The method
implementation 4. The command must return Tcl code that will be
evaluated to create the method 5. In this example: - Creates a coroutine
for each async method - Uses <code>yield</code> to make the method
non-blocking - <code>uplevel 1</code> ensures proper variable scope</p>
<p>Usage example with explanation:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode tcl"><code class="sourceCode tcl"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>nx::Class <span class="ot">create</span> AsyncService <span class="kw">{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The -type async flag tells NX to use our custom method type</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    :method<span class="ot"> -type</span> async longOperation <span class="kw">{}</span> <span class="kw">{</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">after</span> <span class="dv">1000</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> <span class="st">&quot;Operation complete&quot;</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># When called:</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> service <span class="kw">[</span>AsyncService new<span class="kw">]</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="dt">$service</span> longOperation ;<span class="co"># Returns immediately, runs in background</span></span></code></pre></div>
<h4 id="method-property-extensions">Method Property Extensions</h4>
<p>Method properties allow you to attach metadata and behavior modifiers
to methods. NSF provides a flexible system for defining and handling
custom method properties.</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode tcl"><code class="sourceCode tcl"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add custom method properties</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>::nsf::method::property Object myMethod cached <span class="dv">1</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>::nsf::method::property Object myMethod timeout <span class="dv">5000</span></span></code></pre></div>
<p>How properties work: 1. Properties are key-value pairs attached to
methods 2. They can be: - Metadata (like deprecation flags) - Behavior
modifiers (like access control) - Runtime configuration (like timeouts)
3. Properties are inherited when methods are inherited 4. Properties can
trigger behavior through property handlers</p>
<p>Property Handler Implementation:</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode tcl"><code class="sourceCode tcl"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>nx::Class <span class="ot">create</span> PropertyHandler <span class="kw">{</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    :property propertyName</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    :property handler:object</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    :public method handleProperty <span class="kw">{</span>obj method property value<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">switch</span> <span class="dt">$property</span> <span class="kw">{</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;cached&quot;</span> <span class="kw">{</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Implement method result caching</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>                <span class="kw">set</span> original <span class="kw">[</span><span class="dt">$obj</span> <span class="kw">info</span> method definition <span class="dt">$method</span><span class="kw">]</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>                <span class="dt">$obj</span> <span class="kw">eval</span> <span class="kw">{</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>                    :public method <span class="dt">$method</span> <span class="ot">args</span> <span class="kw">{</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># Check cache first</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>                        <span class="kw">if</span> <span class="kw">{[info</span> <span class="ot">exists</span> :cache(<span class="dt">$method</span>)<span class="kw">]}</span> <span class="kw">{</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>                            <span class="kw">return</span> <span class="dt">${:cache($method)}</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>                        <span class="kw">}</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># Execute and cache</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>                        <span class="kw">set</span> result <span class="kw">[uplevel</span> <span class="dv">1</span> <span class="dt">$original</span> <span class="kw">{</span>*<span class="kw">}</span><span class="dt">$args</span><span class="kw">]</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>                        <span class="kw">set</span> :cache(<span class="dt">$method</span>) <span class="dt">$result</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>                        <span class="kw">return</span> <span class="dt">$result</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">}</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>                <span class="kw">}</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>            <span class="kw">}</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;timeout&quot;</span> <span class="kw">{</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Implement method timeout</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>                <span class="kw">set</span> original <span class="kw">[</span><span class="dt">$obj</span> <span class="kw">info</span> method definition <span class="dt">$method</span><span class="kw">]</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>                <span class="dt">$obj</span> <span class="kw">eval</span> <span class="kw">{</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>                    :public method <span class="dt">$method</span> <span class="ot">args</span> <span class="kw">{</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># Set up timeout</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>                        <span class="kw">set</span> done <span class="dv">0</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>                        <span class="kw">set</span> result <span class="st">&quot;&quot;</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>                        <span class="kw">after</span> <span class="dt">$value</span> <span class="kw">[list</span> <span class="kw">set</span> done <span class="dv">1</span><span class="kw">]</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># Execute with timeout</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>                        <span class="kw">if</span> <span class="kw">{[catch</span> <span class="kw">{</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>                            <span class="kw">set</span> result <span class="kw">[uplevel</span> <span class="dv">1</span> <span class="dt">$original</span> <span class="kw">{</span>*<span class="kw">}</span><span class="dt">$args</span><span class="kw">]</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>                        <span class="kw">}</span> err<span class="kw">]}</span> <span class="kw">{</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>                            <span class="kw">if</span> <span class="kw">{</span><span class="dt">$done</span><span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>                                <span class="kw">error</span> <span class="st">&quot;Method timeout after </span><span class="dt">$</span><span class="st">{value}ms&quot;</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>                            <span class="kw">}</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>                            <span class="kw">error</span> <span class="dt">$err</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>                        <span class="kw">}</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>                        <span class="kw">return</span> <span class="dt">$result</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">}</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>                <span class="kw">}</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>            <span class="kw">}</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<h3 id="type-system-extensions">Type System Extensions</h3>
<p>The NX type system is extensible, allowing you to create custom types
with validation and conversion logic. Types can be used for both method
parameters and object properties.</p>
<h4 id="custom-type-checkers">Custom Type Checkers</h4>
<p>Type checkers validate and potentially convert values at runtime.
They’re used in method parameters and object properties.</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode tcl"><code class="sourceCode tcl"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a complex number type</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>::nsf::<span class="ot">type</span>::<span class="ot">create</span> complex <span class="kw">{</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Validation logic</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    -<span class="ot">validate</span> <span class="kw">{</span>value<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="kw">{</span>!<span class="kw">[regexp</span> <span class="kw">{</span>^-?<span class="ch">\d</span>+(<span class="ch">\.\d</span>+)?<span class="kw">[</span>+-<span class="kw">]</span><span class="ch">\d</span>+(<span class="ch">\.\d</span>+)?i$<span class="kw">}</span> <span class="dt">$value</span><span class="kw">]}</span> <span class="kw">{</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>            <span class="kw">error</span> <span class="st">&quot;Invalid complex number format: </span><span class="dt">$</span><span class="st">value&quot;</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> <span class="dt">$value</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Optional conversion logic</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    -convert <span class="kw">{</span>value<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Convert from different formats</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">switch</span><span class="ot"> -regexp</span> <span class="dt">$value</span> <span class="kw">{</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>            <span class="kw">{</span>^<span class="ch">\[</span><span class="kw">}</span> <span class="kw">{</span> # Array <span class="kw">format</span> <span class="kw">[list</span> real imag<span class="kw">]</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>                <span class="kw">lassign</span> <span class="dt">$value</span> real imag</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>                <span class="kw">return</span> <span class="st">&quot;</span><span class="dt">$</span><span class="st">real+</span><span class="dt">$</span><span class="st">{imag}i&quot;</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>            <span class="kw">}</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>            <span class="kw">{</span>^polar:<span class="kw">}</span> <span class="kw">{</span> # Polar <span class="kw">format</span> polar:r:theta</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>                <span class="kw">lassign</span> <span class="kw">[split</span> <span class="dt">$value</span> :<span class="kw">]</span> _ r theta</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>                <span class="kw">set</span> real <span class="kw">[expr</span> <span class="kw">{</span><span class="dt">$r</span> * cos(<span class="dt">$theta</span>)<span class="kw">}]</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>                <span class="kw">set</span> imag <span class="kw">[expr</span> <span class="kw">{</span><span class="dt">$r</span> * sin(<span class="dt">$theta</span>)<span class="kw">}]</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>                <span class="kw">return</span> <span class="st">&quot;</span><span class="dt">$</span><span class="st">real+</span><span class="dt">$</span><span class="st">{imag}i&quot;</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>            <span class="kw">}</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>            <span class="ot">default</span> <span class="kw">{</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>                <span class="kw">return</span> <span class="dt">$value</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>            <span class="kw">}</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>How type checkers work: 1. <code>-validate</code> defines validation
logic - Receives the value to validate - Must return validated value or
throw error 2. <code>-convert</code> (optional) defines conversion logic
- Allows accepting different input formats - Must return value in
canonical format 3. Types can be combined with constraints 4. Types are
used in method parameters and properties</p>
<p>Usage in different contexts:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode tcl"><code class="sourceCode tcl"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>nx::Class <span class="ot">create</span> ComplexMath <span class="kw">{</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Property with complex type</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    :property <span class="kw">{</span>z:complex <span class="st">&quot;0+0i&quot;</span><span class="kw">}</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Method parameter with complex type</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    :public method <span class="ot">add</span> <span class="kw">{</span>a:complex b:complex<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Parse complex numbers</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">regexp</span> <span class="kw">{</span>(.+)(<span class="kw">[</span>+-<span class="kw">]</span>.+)i<span class="kw">}</span> <span class="dt">$a</span> -&gt; aReal aImag</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">regexp</span> <span class="kw">{</span>(.+)(<span class="kw">[</span>+-<span class="kw">]</span>.+)i<span class="kw">}</span> <span class="dt">$b</span> -&gt; bReal bImag</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Perform addition</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>        <span class="kw">set</span> realPart <span class="kw">[expr</span> <span class="kw">{</span><span class="dt">$aReal</span> + <span class="dt">$bReal</span><span class="kw">}]</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">set</span> imagPart <span class="kw">[expr</span> <span class="kw">{</span><span class="dt">$aImag</span> + <span class="dt">$bImag</span><span class="kw">}]</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> <span class="st">&quot;</span><span class="dt">$</span><span class="st">realPart</span><span class="dt">$</span><span class="st">imagPart&quot;</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Using conversion</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    :public method fromPolar <span class="kw">{</span>r theta<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>        <span class="kw">set</span> :z <span class="kw">[</span>complex convert <span class="st">&quot;polar:</span><span class="dt">$</span><span class="st">r:</span><span class="dt">$</span><span class="st">theta&quot;</span><span class="kw">]</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<h4 id="parameter-constraints">Parameter Constraints</h4>
<p>Constraints add additional validation rules to types. They can be
combined with types and with other constraints.</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode tcl"><code class="sourceCode tcl"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a range constraint</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>::nsf::<span class="ot">type</span>::<span class="ot">create</span> <span class="ot">range</span> <span class="kw">{</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Validate constraint arguments</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    -validatearg <span class="kw">{</span>min max<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="kw">{</span>!(<span class="kw">[string</span> <span class="ot">is</span> double<span class="ot"> -strict</span> <span class="dt">$min</span><span class="kw">]</span> &amp;&amp; </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>              <span class="kw">[string</span> <span class="ot">is</span> double<span class="ot"> -strict</span> <span class="dt">$max</span><span class="kw">]</span> &amp;&amp;</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>              <span class="dt">$min</span> &lt; <span class="dt">$max</span>)<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>            <span class="kw">error</span> <span class="st">&quot;Invalid range specification: </span><span class="dt">$</span><span class="st">min..</span><span class="dt">$</span><span class="st">max&quot;</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Validate values against constraint</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    -<span class="ot">validate</span> <span class="kw">{</span>value min max<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="kw">{</span><span class="dt">$value</span> &lt; <span class="dt">$min</span> || <span class="dt">$value</span> &gt; <span class="dt">$max</span><span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>            <span class="kw">error</span> <span class="st">&quot;Value </span><span class="dt">$</span><span class="st">value outside range </span><span class="dt">$</span><span class="st">min..</span><span class="dt">$</span><span class="st">max&quot;</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> <span class="dt">$value</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>How constraints work: 1. <code>-validatearg</code> validates
constraint parameters - Called when constraint is used in type
specification - Ensures constraint is properly configured 2.
<code>-validate</code> checks values against constraint - Receives value
and constraint parameters - Must return validated value or throw error
3. Constraints can be combined with types and other constraints 4.
Constraints can be parameterized</p>
<p>Example of combined constraints:</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode tcl"><code class="sourceCode tcl"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>nx::Class <span class="ot">create</span> Temperature <span class="kw">{</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Combine type and constraint</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    :property <span class="kw">{</span>celsius:double,<span class="ot">range</span>,-<span class="dv">273</span>.<span class="dv">15</span>..<span class="dv">100</span><span class="kw">}</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Multiple constraints</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    :property <span class="kw">{</span>pressure:double,<span class="ot">range</span>,<span class="dv">0</span>..<span class="dv">1000</span>,nonzero<span class="kw">}</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Custom error handling</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    :public method setCelsius <span class="kw">{</span>temp:double,<span class="ot">range</span>,-<span class="dv">273</span>.<span class="dv">15</span>..<span class="dv">100</span><span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>        try <span class="kw">{</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>            <span class="kw">set</span> :celsius <span class="dt">$temp</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span> trap <span class="kw">{</span>INVALID RANGE<span class="kw">}</span> <span class="kw">{</span>err<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>            <span class="kw">error</span> <span class="st">&quot;Temperature </span><span class="dt">$</span><span class="st">temp°C is physically impossible!&quot;</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<h2 id="meta-class-extensions">2. Meta-Class Extensions</h2>
<p>Meta-classes in NX control how classes are created and behave. They
provide a powerful way to modify class behavior and implement design
patterns at the class level.</p>
<h3 id="custom-meta-classes">Custom Meta-Classes</h3>
<p>Meta-classes allow you to: 1. Control class instantiation 2. Add
class-level behavior 3. Implement design patterns 4. Modify class
creation process</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode tcl"><code class="sourceCode tcl"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a singleton meta-class</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>nx::Class <span class="ot">create</span> SingletonClass<span class="ot"> -superclass</span> nx::Class <span class="kw">{</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    :property instance:object,<span class="dv">0</span>..<span class="dv">1</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Override new to implement singleton pattern</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    :public method new <span class="kw">{</span><span class="ot">args</span><span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="kw">{</span>!<span class="kw">[info</span> <span class="ot">exists</span> :instance<span class="kw">]}</span> <span class="kw">{</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>            <span class="kw">set</span> :instance <span class="kw">[</span>next <span class="kw">{</span>*<span class="kw">}</span><span class="dt">$args</span><span class="kw">]</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> <span class="dt">${:instance}</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add class-level functionality</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    :public method reset <span class="kw">{}</span> <span class="kw">{</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="kw">{[info</span> <span class="ot">exists</span> :instance<span class="kw">]}</span> <span class="kw">{</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>            <span class="dt">${:instance}</span> <span class="kw">destroy</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>            <span class="kw">unset</span> :instance</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>How meta-classes work: 1. Meta-classes are classes that create
classes 2. They inherit from <code>nx::Class</code> 3. Can override
methods like <code>new</code> to control instantiation 4. Can add
class-level properties and methods 5. Affect all classes created with
this meta-class</p>
<p>Usage example with explanation:</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode tcl"><code class="sourceCode tcl"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a singleton class</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>nx::Class <span class="ot">create</span> Logger<span class="ot"> -metaclass</span> SingletonClass <span class="kw">{</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    :property logFile</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    :property <span class="kw">{</span><span class="ot">level</span> <span class="st">&quot;INFO&quot;</span><span class="kw">}</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    :public method log <span class="kw">{</span>msg<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">puts</span> <span class="st">&quot;[</span><span class="dt">$</span><span class="st">level] </span><span class="dt">$</span><span class="st">msg&quot;</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Usage demonstration</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> logger1 <span class="kw">[</span>Logger new<span class="kw">]</span>  ;<span class="co"># Creates first instance</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> logger2 <span class="kw">[</span>Logger new<span class="kw">]</span>  ;<span class="co"># Returns same instance</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="kw">expr</span> <span class="kw">{</span><span class="dt">$logger1</span> eq <span class="dt">$logger2</span><span class="kw">}</span>  ;<span class="co"># Returns 1 (true)</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Reset singleton state</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>Logger reset  ;<span class="co"># Destroys instance</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> logger3 <span class="kw">[</span>Logger new<span class="kw">]</span>  ;<span class="co"># Creates new instance</span></span></code></pre></div>
<h3 id="aspect-oriented-extensions">Aspect-Oriented Extensions</h3>
<p>Aspect-Oriented Programming (AOP) in NX allows you to add behavior
that cuts across multiple classes without modifying their code
directly.</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode tcl"><code class="sourceCode tcl"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an aspect system</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>nx::Class <span class="ot">create</span> Aspect <span class="kw">{</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    :property target:object</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    :property pointcut:method</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    :property advice:object</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Different types of advice</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    :public method beforeAdvice <span class="kw">{</span><span class="ot">body</span><span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">set</span> original <span class="kw">[</span><span class="dt">${:target}</span> <span class="kw">info</span> method definition <span class="dt">${:pointcut}</span><span class="kw">]</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">${:target}</span> <span class="kw">eval</span> <span class="kw">{</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>            :public method <span class="dt">${:pointcut}</span> <span class="ot">args</span> <span class="kw">{</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Execute advice</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>                <span class="kw">uplevel</span> <span class="dv">1</span> <span class="dt">$body</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Execute original method</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>                <span class="kw">uplevel</span> <span class="dv">1</span> <span class="dt">$original</span> <span class="kw">{</span>*<span class="kw">}</span><span class="dt">$args</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>            <span class="kw">}</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    :public method afterAdvice <span class="kw">{</span><span class="ot">body</span><span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>        <span class="kw">set</span> original <span class="kw">[</span><span class="dt">${:target}</span> <span class="kw">info</span> method definition <span class="dt">${:pointcut}</span><span class="kw">]</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>        <span class="dt">${:target}</span> <span class="kw">eval</span> <span class="kw">{</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>            :public method <span class="dt">${:pointcut}</span> <span class="ot">args</span> <span class="kw">{</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Execute original method</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>                <span class="kw">set</span> result <span class="kw">[uplevel</span> <span class="dv">1</span> <span class="dt">$original</span> <span class="kw">{</span>*<span class="kw">}</span><span class="dt">$args</span><span class="kw">]</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Execute advice</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>                <span class="kw">uplevel</span> <span class="dv">1</span> <span class="dt">$body</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>                <span class="kw">return</span> <span class="dt">$result</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>            <span class="kw">}</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>    :public method aroundAdvice <span class="kw">{</span><span class="ot">body</span><span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>        <span class="kw">set</span> original <span class="kw">[</span><span class="dt">${:target}</span> <span class="kw">info</span> method definition <span class="dt">${:pointcut}</span><span class="kw">]</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>        <span class="dt">${:target}</span> <span class="kw">eval</span> <span class="kw">{</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>            :public method <span class="dt">${:pointcut}</span> <span class="ot">args</span> <span class="kw">{</span></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Make original method available to advice</span></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>                <span class="kw">set</span> proceed <span class="kw">[list</span> <span class="kw">uplevel</span> <span class="dv">1</span> <span class="dt">$original</span> <span class="kw">{</span>*<span class="kw">}</span><span class="dt">$args</span><span class="kw">]</span></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Execute advice with access to proceed</span></span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>                <span class="kw">uplevel</span> <span class="dv">1</span> <span class="kw">[list</span> apply <span class="kw">{{</span>proceed <span class="ot">body</span><span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">uplevel</span> <span class="dv">1</span> <span class="dt">$body</span></span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>                <span class="kw">}}</span> <span class="dt">$proceed</span> <span class="dt">$body</span><span class="kw">]</span></span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>            <span class="kw">}</span></span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>How aspects work: 1. Aspects intercept method calls 2. Types of
advice: - Before: Runs before method - After: Runs after method -
Around: Wraps method execution 3. Pointcuts define where advice applies
4. Advice defines what happens at pointcut</p>
<p>Example usage:</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode tcl"><code class="sourceCode tcl"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a logging aspect</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>nx::Class <span class="ot">create</span> LoggingAspect<span class="ot"> -superclass</span> Aspect <span class="kw">{</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    :property <span class="kw">{</span>logLevel <span class="st">&quot;INFO&quot;</span><span class="kw">}</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    :public method applyLogging <span class="kw">{}</span> <span class="kw">{</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>        :beforeAdvice <span class="kw">{</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>            <span class="kw">puts</span> <span class="st">&quot;</span><span class="ch">\[</span><span class="dt">$</span><span class="st">logLevel</span><span class="ch">\]</span><span class="st"> Entering [</span><span class="dt">$</span><span class="st">{:target}] </span><span class="dt">$</span><span class="st">{:pointcut}&quot;</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>        :afterAdvice <span class="kw">{</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>            <span class="kw">puts</span> <span class="st">&quot;</span><span class="ch">\[</span><span class="dt">$</span><span class="st">logLevel</span><span class="ch">\]</span><span class="st"> Exiting [</span><span class="dt">$</span><span class="st">{:target}] </span><span class="dt">$</span><span class="st">{:pointcut}&quot;</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply aspect to a class</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>nx::Class <span class="ot">create</span> MyService <span class="kw">{</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    :public method processData <span class="kw">{</span>data<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Process data</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> <span class="kw">[string</span> <span class="ot">toupper</span> <span class="dt">$data</span><span class="kw">]</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>LoggingAspect <span class="ot">create</span> logger <span class="kw">{</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    :property target <span class="kw">[</span>MyService <span class="kw">info</span> instances<span class="kw">]</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    :property pointcut <span class="st">&quot;processData&quot;</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    :applyLogging</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<h2 id="object-system-extensions">3. Object System Extensions</h2>
<p>The NX object system can be extended to customize object creation,
lifecycle management, and behavior.</p>
<h3 id="custom-object-creation">Custom Object Creation</h3>
<p>Object creation can be customized to add initialization logic,
validation, and setup code.</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode tcl"><code class="sourceCode tcl"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extend object creation process</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>nx::Class <span class="ot">create</span> CustomClass<span class="ot"> -superclass</span> nx::Class <span class="kw">{</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    :property <span class="kw">{</span>initHooks:<span class="kw">list</span> <span class="kw">{}}</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    :public method <span class="ot">create</span> <span class="kw">{</span><span class="ot">name</span> <span class="ot">args</span><span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Pre-creation hooks</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>        :preCreate <span class="dt">$name</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create instance with custom initialization</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">set</span> obj <span class="kw">[</span>next <span class="dt">$name</span> <span class="kw">{</span>*<span class="kw">}</span><span class="dt">$args</span><span class="kw">]</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Run initialization hooks</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">foreach</span> hook <span class="dt">${:initHooks}</span> <span class="kw">{</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>            <span class="dt">$obj</span> <span class="kw">eval</span> <span class="dt">$hook</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Post-creation customization</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>        :postCreate <span class="dt">$obj</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> <span class="dt">$obj</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>    :protected method preCreate <span class="kw">{</span><span class="ot">name</span><span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Validate class name</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="kw">{</span>!<span class="kw">[regexp</span> <span class="kw">{</span>^<span class="kw">[</span>a-zA-Z<span class="kw">][</span>a-zA-Z0<span class="dv">-9</span>_<span class="kw">]</span>*$<span class="kw">}</span> <span class="dt">$name</span><span class="kw">]}</span> <span class="kw">{</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>            <span class="kw">error</span> <span class="st">&quot;Invalid class name: </span><span class="dt">$</span><span class="st">name&quot;</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Setup environment</span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>        :setupEnvironment <span class="dt">$name</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>    :protected method postCreate <span class="kw">{</span>obj<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Initialize object state</span></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>        <span class="dt">$obj</span> <span class="kw">eval</span> <span class="kw">{</span></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>            :initializeState</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Register object</span></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>        :registerObject <span class="dt">$obj</span></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>    :protected method setupEnvironment <span class="kw">{</span><span class="ot">name</span><span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create necessary directories/files</span></span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>        <span class="kw">file</span> <span class="ot">mkdir</span> <span class="st">&quot;objects/</span><span class="dt">$</span><span class="st">name&quot;</span></span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>    :protected method registerObject <span class="kw">{</span>obj<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add to registry</span></span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>        <span class="kw">dict</span> <span class="kw">set</span> :objectRegistry <span class="kw">[</span><span class="dt">$obj</span> <span class="ot">name</span><span class="kw">]</span> <span class="dt">$obj</span></span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>    :public method addInitHook <span class="kw">{</span>hook<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lappend</span> :initHooks <span class="dt">$hook</span></span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>How custom creation works: 1. Override <code>create</code> method to
customize creation 2. Add pre-creation validation and setup 3. Support
initialization hooks 4. Perform post-creation tasks 5. Maintain object
registry</p>
<p>Example usage:</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode tcl"><code class="sourceCode tcl"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a class with custom creation</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>nx::Class <span class="ot">create</span> Component<span class="ot"> -metaclass</span> CustomClass <span class="kw">{</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    :property <span class="ot">name</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    :property <span class="ot">state</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    :public method initializeState <span class="kw">{}</span> <span class="kw">{</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">set</span> :<span class="ot">state</span> <span class="st">&quot;initialized&quot;</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Add initialization hook</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>Component addInitHook <span class="kw">{</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    :public method start <span class="kw">{}</span> <span class="kw">{</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">set</span> :<span class="ot">state</span> <span class="st">&quot;running&quot;</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Create instance</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> comp <span class="kw">[</span>Component new<span class="ot"> -name</span> <span class="st">&quot;MyComponent&quot;</span><span class="kw">]</span></span></code></pre></div>
<h3 id="object-lifecycle-management">Object Lifecycle Management</h3>
<p>Lifecycle management allows you to control object state transitions
and cleanup.</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode tcl"><code class="sourceCode tcl"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add lifecycle management</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>nx::Class <span class="ot">create</span> ManagedObject <span class="kw">{</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    :property <span class="kw">{</span><span class="ot">state</span> <span class="st">&quot;new&quot;</span><span class="kw">}</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    :property <span class="kw">{</span>stateHandlers:<span class="kw">dict</span> <span class="kw">{}}</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    :property <span class="kw">{</span>transitions:<span class="kw">dict</span> <span class="kw">{</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>        new <span class="kw">{</span>initialized<span class="kw">}</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>        initialized <span class="kw">{</span>active suspended<span class="kw">}</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>        active <span class="kw">{</span>suspended<span class="kw">}</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>        suspended <span class="kw">{</span>active terminated<span class="kw">}</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>        terminated <span class="kw">{}</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}}</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    :public method init <span class="kw">{}</span> <span class="kw">{</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>        next</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>        :changeState <span class="st">&quot;initialized&quot;</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    :public method <span class="ot">activate</span> <span class="kw">{}</span> <span class="kw">{</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>        :changeState <span class="st">&quot;active&quot;</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>    :public method suspend <span class="kw">{}</span> <span class="kw">{</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>        :changeState <span class="st">&quot;suspended&quot;</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>    :public method terminate <span class="kw">{}</span> <span class="kw">{</span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>        :changeState <span class="st">&quot;terminated&quot;</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>    :protected method changeState <span class="kw">{</span>newState<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Validate transition</span></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="kw">{</span>!<span class="kw">[</span>:isValidTransition <span class="dt">$newState</span><span class="kw">]}</span> <span class="kw">{</span></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>            <span class="kw">error</span> <span class="st">&quot;Invalid transition from </span><span class="dt">$</span><span class="st">{:state} to </span><span class="dt">$</span><span class="st">newState&quot;</span></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Execute exit handler</span></span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="kw">{[dict</span> <span class="ot">exists</span> <span class="dt">${:stateHandlers}</span> <span class="dt">${:state}</span> <span class="kw">exit]}</span> <span class="kw">{</span></span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>            <span class="kw">uplevel</span> <span class="dv">1</span> <span class="kw">[dict</span> <span class="ot">get</span> <span class="dt">${:stateHandlers}</span> <span class="dt">${:state}</span> <span class="kw">exit]</span></span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>        <span class="kw">set</span> oldState <span class="dt">${:state}</span></span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>        <span class="kw">set</span> :<span class="ot">state</span> <span class="dt">$newState</span></span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Execute entry handler</span></span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="kw">{[dict</span> <span class="ot">exists</span> <span class="dt">${:stateHandlers}</span> <span class="dt">$newState</span> <span class="kw">entry]}</span> <span class="kw">{</span></span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a>            <span class="kw">uplevel</span> <span class="dv">1</span> <span class="kw">[dict</span> <span class="ot">get</span> <span class="dt">${:stateHandlers}</span> <span class="dt">$newState</span> <span class="kw">entry]</span></span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>        :notifyStateChange <span class="dt">$oldState</span> <span class="dt">$newState</span></span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a>    :protected method isValidTransition <span class="kw">{</span>newState<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a>        <span class="kw">expr</span> <span class="kw">{[lsearch</span> <span class="kw">[dict</span> <span class="ot">get</span> <span class="dt">${:transitions}</span> <span class="dt">${:state}</span><span class="kw">]</span> <span class="dt">$newState</span><span class="kw">]</span> &gt;= <span class="dv">0</span><span class="kw">}</span></span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a>    :public method addStateHandler <span class="kw">{</span><span class="ot">state</span> <span class="ot">type</span> <span class="ot">script</span><span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a>        <span class="kw">dict</span> <span class="kw">set</span> :stateHandlers <span class="dt">$state</span> <span class="dt">$type</span> <span class="dt">$script</span></span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a>    :protected method notifyStateChange <span class="kw">{</span>old new<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true" tabindex="-1"></a>        :notifyObservers stateChanged <span class="kw">[list</span> old <span class="dt">$old</span> new <span class="dt">$new</span><span class="kw">]</span></span>
<span id="cb15-62"><a href="#cb15-62" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb15-63"><a href="#cb15-63" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>How lifecycle management works: 1. Define possible states and
transitions 2. Add state entry/exit handlers 3. Validate state
transitions 4. Notify observers of changes 5. Support cleanup and
termination</p>
<p>Example usage:</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode tcl"><code class="sourceCode tcl"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create managed service</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>nx::Class <span class="ot">create</span> Service<span class="ot"> -superclass</span> ManagedObject <span class="kw">{</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    :property <span class="ot">name</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    :property resources:<span class="kw">list</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    :public method init <span class="kw">{}</span> <span class="kw">{</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>        next</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add state handlers</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>        :addStateHandler active <span class="kw">entry</span> <span class="kw">{</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>            <span class="kw">puts</span> <span class="st">&quot;Starting service </span><span class="dt">$</span><span class="st">{:name}&quot;</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>            :allocateResources</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>        :addStateHandler active <span class="kw">exit</span> <span class="kw">{</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>            <span class="kw">puts</span> <span class="st">&quot;Stopping service </span><span class="dt">$</span><span class="st">{:name}&quot;</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>            :releaseResources</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>    :protected method allocateResources <span class="kw">{}</span> <span class="kw">{</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lappend</span> :resources <span class="st">&quot;database_connection&quot;</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lappend</span> :resources <span class="st">&quot;cache_client&quot;</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>    :protected method releaseResources <span class="kw">{}</span> <span class="kw">{</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>        <span class="kw">foreach</span> <span class="kw">resource</span> <span class="dt">${:resources}</span> <span class="kw">{</span></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>            <span class="kw">puts</span> <span class="st">&quot;Releasing </span><span class="dt">$</span><span class="st">resource&quot;</span></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>        <span class="kw">set</span> :resources <span class="kw">{}</span></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Usage</span></span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> svc <span class="kw">[</span>Service new<span class="ot"> -name</span> <span class="st">&quot;MyService&quot;</span><span class="kw">]</span></span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a><span class="dt">$svc</span> <span class="ot">activate</span>   ;<span class="co"># Allocates resources</span></span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a><span class="dt">$svc</span> suspend    ;<span class="co"># Releases resources</span></span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a><span class="dt">$svc</span> <span class="ot">activate</span>   ;<span class="co"># Reallocates resources</span></span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a><span class="dt">$svc</span> terminate  ;<span class="co"># Final cleanup</span></span></code></pre></div>
<h2 id="advanced-extensions">4. Advanced Extensions</h2>
<h3 id="custom-method-resolution">Custom Method Resolution</h3>
<p>Method resolution in NX can be customized to implement features like
method fuzzy matching, delegation, and dynamic dispatch.</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode tcl"><code class="sourceCode tcl"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a method resolution system</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>nx::Class <span class="ot">create</span> MethodResolver <span class="kw">{</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    :property <span class="ot">class</span>:object</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    :property <span class="kw">{</span>cache:<span class="kw">dict</span> <span class="kw">{}}</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    :property <span class="kw">{</span>resolverRules:<span class="kw">list</span> <span class="kw">{}}</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    :public method resolveMethod <span class="kw">{</span><span class="ot">name</span><span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Check cache first</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="kw">{[dict</span> <span class="ot">exists</span> <span class="dt">${:cache}</span> <span class="dt">$name</span><span class="kw">]}</span> <span class="kw">{</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span> <span class="kw">[dict</span> <span class="ot">get</span> <span class="dt">${:cache}</span> <span class="dt">$name</span><span class="kw">]</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Apply resolution rules</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">foreach</span> rule <span class="dt">${:resolverRules}</span> <span class="kw">{</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="kw">{[set</span> method <span class="kw">[</span>:applyRule <span class="dt">$rule</span> <span class="dt">$name</span><span class="kw">]]</span> ne <span class="st">&quot;&quot;</span><span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>                <span class="kw">dict</span> <span class="kw">set</span> :cache <span class="dt">$name</span> <span class="dt">$method</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>                <span class="kw">return</span> <span class="dt">$method</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>            <span class="kw">}</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> <span class="st">&quot;&quot;</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>    :public method addRule <span class="kw">{</span>rule<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lappend</span> :resolverRules <span class="dt">$rule</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>    :protected method applyRule <span class="kw">{</span>rule <span class="ot">name</span><span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>        <span class="kw">switch</span> <span class="kw">[dict</span> <span class="ot">get</span> <span class="dt">$rule</span> <span class="ot">type</span><span class="kw">]</span> <span class="kw">{</span></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;fuzzy&quot;</span> <span class="kw">{</span></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Fuzzy match against method names</span></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>                <span class="kw">set</span> methods <span class="kw">[</span><span class="dt">${:class}</span> <span class="kw">info</span> methods<span class="kw">]</span></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>                <span class="kw">set</span> matches <span class="kw">[lsort</span><span class="ot"> -command</span> <span class="kw">[list</span> :fuzzyCompare <span class="dt">$name</span><span class="kw">]</span> <span class="dt">$methods</span><span class="kw">]</span></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>                <span class="kw">return</span> <span class="kw">[lindex</span> <span class="dt">$matches</span> <span class="dv">0</span><span class="kw">]</span></span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>            <span class="kw">}</span></span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;prefix&quot;</span> <span class="kw">{</span></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Match methods with prefix</span></span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>                <span class="kw">set</span> prefix <span class="kw">[dict</span> <span class="ot">get</span> <span class="dt">$rule</span> prefix<span class="kw">]</span></span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>                <span class="kw">set</span> methods <span class="kw">[</span><span class="dt">${:class}</span> <span class="kw">info</span> methods <span class="st">&quot;</span><span class="dt">$</span><span class="st">{prefix}*&quot;</span><span class="kw">]</span></span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>                <span class="kw">return</span> <span class="kw">[lindex</span> <span class="dt">$methods</span> <span class="dv">0</span><span class="kw">]</span></span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>            <span class="kw">}</span></span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;delegate&quot;</span> <span class="kw">{</span></span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Delegate to another object</span></span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>                <span class="kw">set</span> target <span class="kw">[dict</span> <span class="ot">get</span> <span class="dt">$rule</span> target<span class="kw">]</span></span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> <span class="kw">{[</span><span class="dt">$target</span> <span class="kw">info</span> methods<span class="ot"> -callprotection</span> public <span class="dt">$name</span><span class="kw">]</span> ne <span class="st">&quot;&quot;</span><span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">return</span> <span class="kw">[list</span> delegate <span class="dt">$target</span> <span class="dt">$name</span><span class="kw">]</span></span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a>                <span class="kw">}</span></span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a>            <span class="kw">}</span></span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> <span class="st">&quot;&quot;</span></span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a>    :protected method fuzzyCompare <span class="kw">{</span>target str1 str2<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Simple Levenshtein distance comparison</span></span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a>        <span class="kw">set</span> dist1 <span class="kw">[</span>:levenshteinDistance <span class="dt">$target</span> <span class="dt">$str1</span><span class="kw">]</span></span>
<span id="cb17-56"><a href="#cb17-56" aria-hidden="true" tabindex="-1"></a>        <span class="kw">set</span> dist2 <span class="kw">[</span>:levenshteinDistance <span class="dt">$target</span> <span class="dt">$str2</span><span class="kw">]</span></span>
<span id="cb17-57"><a href="#cb17-57" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> <span class="kw">[expr</span> <span class="kw">{</span><span class="dt">$dist1</span> - <span class="dt">$dist2</span><span class="kw">}]</span></span>
<span id="cb17-58"><a href="#cb17-58" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb17-59"><a href="#cb17-59" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-60"><a href="#cb17-60" aria-hidden="true" tabindex="-1"></a>    :protected method levenshteinDistance <span class="kw">{</span>str1 str2<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb17-61"><a href="#cb17-61" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Compute edit distance between strings</span></span>
<span id="cb17-62"><a href="#cb17-62" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Implementation omitted for brevity</span></span>
<span id="cb17-63"><a href="#cb17-63" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> <span class="dv">0</span></span>
<span id="cb17-64"><a href="#cb17-64" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb17-65"><a href="#cb17-65" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>How custom method resolution works: 1. Resolution rules define how to
find methods 2. Rules can include: - Fuzzy matching - Prefix matching -
Delegation 3. Results are cached for performance 4. Can be extended with
new rule types</p>
<p>Example usage:</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode tcl"><code class="sourceCode tcl"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a class with custom method resolution</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>nx::Class <span class="ot">create</span> FuzzyClass <span class="kw">{</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    :property resolver:object <span class="kw">[</span>MethodResolver new<span class="ot"> -class</span> <span class="kw">[</span>self<span class="kw">]]</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    :public method init <span class="kw">{}</span> <span class="kw">{</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>        next</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add resolution rules</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">${:resolver}</span> addRule <span class="kw">[dict</span> <span class="ot">create</span> \</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>            <span class="ot">type</span> fuzzy \</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>            threshold <span class="fl">0.8</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>        <span class="kw">]</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">${:resolver}</span> addRule <span class="kw">[dict</span> <span class="ot">create</span> \</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>            <span class="ot">type</span> prefix \</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>            prefix <span class="st">&quot;handle&quot;</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">]</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>        <span class="dt">${:resolver}</span> addRule <span class="kw">[dict</span> <span class="ot">create</span> \</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>            <span class="ot">type</span> delegate \</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>            target <span class="kw">[</span>DelegateTarget new<span class="kw">]</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>        <span class="kw">]</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>    :public method <span class="kw">unknown</span> <span class="kw">{</span><span class="ot">name</span> <span class="ot">args</span><span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="kw">{[set</span> method <span class="kw">[</span><span class="dt">${:resolver}</span> resolveMethod <span class="dt">$name</span><span class="kw">]]</span> ne <span class="st">&quot;&quot;</span><span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="kw">{[lindex</span> <span class="dt">$method</span> <span class="dv">0</span><span class="kw">]</span> eq <span class="st">&quot;delegate&quot;</span><span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>                <span class="kw">lassign</span> <span class="dt">$method</span> _ target methodName</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>                <span class="kw">return</span> <span class="kw">[</span><span class="dt">$target</span> <span class="dt">$methodName</span> <span class="kw">{</span>*<span class="kw">}</span><span class="dt">$args</span><span class="kw">]</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>            <span class="kw">}</span></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span> <span class="kw">[</span>:<span class="dt">$method</span> <span class="kw">{</span>*<span class="kw">}</span><span class="dt">$args</span><span class="kw">]</span></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>        next <span class="dt">$name</span> <span class="kw">{</span>*<span class="kw">}</span><span class="dt">$args</span></span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>    :public method handleData <span class="kw">{</span>data<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> <span class="st">&quot;Handling </span><span class="dt">$</span><span class="st">data&quot;</span></span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>    :public method processRequest <span class="kw">{</span>req<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> <span class="st">&quot;Processing </span><span class="dt">$</span><span class="st">req&quot;</span></span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<h3 id="dynamic-feature-injection">Dynamic Feature Injection</h3>
<p>Feature injection allows you to dynamically add functionality to
objects and classes at runtime.</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode tcl"><code class="sourceCode tcl"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a feature injection system</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>nx::Class <span class="ot">create</span> FeatureInjector <span class="kw">{</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    :property <span class="kw">{</span>features:<span class="kw">dict</span> <span class="kw">{}}</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    :public method injectMethod <span class="kw">{</span>target <span class="ot">name</span> <span class="ot">body</span> <span class="kw">{</span>protection public<span class="kw">}}</span> <span class="kw">{</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create method definition</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">set</span> methodDef <span class="kw">[list</span> :<span class="dt">$protection</span> method <span class="dt">$name</span> <span class="kw">{}</span> <span class="dt">$body</span><span class="kw">]</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Store feature for potential removal</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">dict</span> <span class="kw">set</span> :features <span class="dt">$target</span> methods <span class="dt">$name</span> <span class="dt">$methodDef</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Inject method</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">$target</span> <span class="kw">eval</span> <span class="dt">$methodDef</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    :public method injectProperty <span class="kw">{</span>target <span class="ot">name</span> <span class="kw">{</span>value <span class="st">&quot;&quot;</span><span class="kw">}</span> <span class="kw">{</span>spec <span class="st">&quot;&quot;</span><span class="kw">}}</span> <span class="kw">{</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create property definition</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>        <span class="kw">set</span> propDef <span class="kw">[list</span> :property<span class="kw">]</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="kw">{</span><span class="dt">$spec</span> ne <span class="st">&quot;&quot;</span><span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>            <span class="kw">lappend</span> propDef <span class="kw">[list</span> <span class="dt">$name</span>:<span class="dt">$spec</span> <span class="dt">$value</span><span class="kw">]</span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span> <span class="kw">else</span> <span class="kw">{</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>            <span class="kw">lappend</span> propDef <span class="kw">[list</span> <span class="dt">$name</span> <span class="dt">$value</span><span class="kw">]</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Store feature</span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>        <span class="kw">dict</span> <span class="kw">set</span> :features <span class="dt">$target</span> properties <span class="dt">$name</span> <span class="dt">$propDef</span></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Inject property</span></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>        <span class="dt">$target</span> <span class="kw">eval</span> <span class="dt">$propDef</span></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>    :public method injectMixin <span class="kw">{</span>target mixin<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add mixin</span></span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>        <span class="dt">$target</span> mixin <span class="ot">add</span> <span class="dt">$mixin</span></span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Store feature</span></span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>        <span class="kw">dict</span> <span class="kw">set</span> :features <span class="dt">$target</span> mixins <span class="dt">$mixin</span> <span class="dv">1</span></span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>    :public method removeFeature <span class="kw">{</span>target <span class="ot">type</span> <span class="ot">name</span><span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>        <span class="kw">switch</span> <span class="dt">$type</span> <span class="kw">{</span></span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;method&quot;</span> <span class="kw">{</span></span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a>                <span class="dt">$target</span> <span class="kw">eval</span> <span class="kw">[list</span> :public method <span class="dt">$name</span><span class="kw">]</span></span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a>                <span class="kw">dict</span> <span class="kw">unset</span> :features <span class="dt">$target</span> methods <span class="dt">$name</span></span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a>            <span class="kw">}</span></span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;property&quot;</span> <span class="kw">{</span></span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a>                <span class="dt">$target</span> <span class="kw">eval</span> <span class="kw">[list</span> :property<span class="ot"> -delete</span> <span class="dt">$name</span><span class="kw">]</span></span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a>                <span class="kw">dict</span> <span class="kw">unset</span> :features <span class="dt">$target</span> properties <span class="dt">$name</span></span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a>            <span class="kw">}</span></span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;mixin&quot;</span> <span class="kw">{</span></span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a>                <span class="dt">$target</span> mixin <span class="ot">delete</span> <span class="dt">$name</span></span>
<span id="cb19-52"><a href="#cb19-52" aria-hidden="true" tabindex="-1"></a>                <span class="kw">dict</span> <span class="kw">unset</span> :features <span class="dt">$target</span> mixins <span class="dt">$name</span></span>
<span id="cb19-53"><a href="#cb19-53" aria-hidden="true" tabindex="-1"></a>            <span class="kw">}</span></span>
<span id="cb19-54"><a href="#cb19-54" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb19-55"><a href="#cb19-55" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb19-56"><a href="#cb19-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-57"><a href="#cb19-57" aria-hidden="true" tabindex="-1"></a>    :public method listInjectedFeatures <span class="kw">{</span>target<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb19-58"><a href="#cb19-58" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="kw">{[dict</span> <span class="ot">exists</span> <span class="dt">${:features}</span> <span class="dt">$target</span><span class="kw">]}</span> <span class="kw">{</span></span>
<span id="cb19-59"><a href="#cb19-59" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span> <span class="kw">[dict</span> <span class="ot">get</span> <span class="dt">${:features}</span> <span class="dt">$target</span><span class="kw">]</span></span>
<span id="cb19-60"><a href="#cb19-60" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb19-61"><a href="#cb19-61" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> <span class="kw">{}</span></span>
<span id="cb19-62"><a href="#cb19-62" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb19-63"><a href="#cb19-63" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>How feature injection works: 1. Features can be: - Methods -
Properties - Mixins 2. Features are tracked for removal 3. Injection is
reversible 4. Supports different protection levels 5. Maintains feature
registry</p>
<p>Example usage:</p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode tcl"><code class="sourceCode tcl"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create injector and target</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> injector <span class="kw">[</span>FeatureInjector new<span class="kw">]</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>nx::Class <span class="ot">create</span> Target <span class="kw">{</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    :property <span class="ot">name</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Inject features</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="dt">$injector</span> injectMethod Target <span class="st">&quot;greet&quot;</span> <span class="kw">{</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> <span class="st">&quot;Hello, </span><span class="dt">$</span><span class="st">{:name}!&quot;</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="dt">$injector</span> injectProperty Target <span class="st">&quot;timestamp&quot;</span> \</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">[clock</span> <span class="ot">seconds</span><span class="kw">]</span> <span class="st">&quot;integer&quot;</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="dt">$injector</span> injectMixin Target Loggable</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Use injected features</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> obj <span class="kw">[</span>Target new<span class="ot"> -name</span> <span class="st">&quot;World&quot;</span><span class="kw">]</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="kw">puts</span> <span class="kw">[</span><span class="dt">$obj</span> greet<span class="kw">]</span>  ;<span class="co"># Outputs: Hello, World!</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove features</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a><span class="dt">$injector</span> removeFeature Target method <span class="st">&quot;greet&quot;</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a><span class="dt">$injector</span> removeFeature Target property <span class="st">&quot;timestamp&quot;</span></span></code></pre></div>
<h3 id="custom-serialization">Custom Serialization</h3>
<p>Serialization allows objects to be converted to and from string
representations for storage or transmission.</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode tcl"><code class="sourceCode tcl"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a serialization system</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>nx::Class <span class="ot">create</span> Serializable <span class="kw">{</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    :property <span class="kw">{</span>serializableVars:<span class="kw">list</span> <span class="kw">{}}</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    :property <span class="kw">{</span>serializers:<span class="kw">dict</span> <span class="kw">{}}</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    :public method init <span class="kw">{}</span> <span class="kw">{</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>        next</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Register basic serializers</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>        :registerSerializer <span class="kw">string</span> <span class="kw">{</span>:toString :fromString<span class="kw">}</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>        :registerSerializer <span class="kw">list</span> <span class="kw">{</span>:toList :fromList<span class="kw">}</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>        :registerSerializer <span class="kw">dict</span> <span class="kw">{</span>:toDict :fromDict<span class="kw">}</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>    :public method registerSerializer <span class="kw">{</span><span class="ot">type</span> methods<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">dict</span> <span class="kw">set</span> :serializers <span class="dt">$type</span> <span class="dt">$methods</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>    :public method addSerializableVar <span class="kw">{</span><span class="ot">name</span> <span class="kw">{</span><span class="ot">type</span> <span class="kw">string}}</span> <span class="kw">{</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="kw">{</span>!<span class="kw">[dict</span> <span class="ot">exists</span> <span class="dt">${:serializers}</span> <span class="dt">$type</span><span class="kw">]}</span> <span class="kw">{</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>            <span class="kw">error</span> <span class="st">&quot;Unknown serializer type: </span><span class="dt">$</span><span class="st">type&quot;</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lappend</span> :serializableVars <span class="kw">[list</span> <span class="dt">$name</span> <span class="dt">$type</span><span class="kw">]</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>    :public method serialize <span class="kw">{}</span> <span class="kw">{</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>        <span class="kw">set</span> data <span class="kw">[dict</span> <span class="ot">create</span><span class="kw">]</span></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>        <span class="kw">foreach</span> var <span class="dt">${:serializableVars}</span> <span class="kw">{</span></span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>            <span class="kw">lassign</span> <span class="dt">$var</span> <span class="ot">name</span> <span class="ot">type</span></span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="kw">{[info</span> <span class="ot">exists</span> :<span class="dt">$name</span><span class="kw">]}</span> <span class="kw">{</span></span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>                <span class="kw">set</span> value <span class="kw">[set</span> :<span class="dt">$name</span><span class="kw">]</span></span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>                <span class="kw">set</span> toMethod <span class="kw">[lindex</span> <span class="kw">[dict</span> <span class="ot">get</span> <span class="dt">${:serializers}</span> <span class="dt">$type</span><span class="kw">]</span> <span class="dv">0</span><span class="kw">]</span></span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>                <span class="kw">dict</span> <span class="kw">set</span> data <span class="dt">$name</span> <span class="kw">[list</span> <span class="dt">$type</span> <span class="kw">[</span>:<span class="dt">$toMethod</span> <span class="dt">$value</span><span class="kw">]]</span></span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>            <span class="kw">}</span></span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> <span class="dt">$data</span></span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a>    :public method deserialize <span class="kw">{</span>data<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>        <span class="kw">dict</span> <span class="kw">for</span> <span class="kw">{</span><span class="ot">name</span> <span class="kw">entry}</span> <span class="dt">$data</span> <span class="kw">{</span></span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>            <span class="kw">lassign</span> <span class="dt">$entry</span> <span class="ot">type</span> value</span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="kw">{[dict</span> <span class="ot">exists</span> <span class="dt">${:serializers}</span> <span class="dt">$type</span><span class="kw">]}</span> <span class="kw">{</span></span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a>                <span class="kw">set</span> fromMethod <span class="kw">[lindex</span> <span class="kw">[dict</span> <span class="ot">get</span> <span class="dt">${:serializers}</span> <span class="dt">$type</span><span class="kw">]</span> <span class="dv">1</span><span class="kw">]</span></span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a>                <span class="kw">set</span> :<span class="dt">$name</span> <span class="kw">[</span>:<span class="dt">$fromMethod</span> <span class="dt">$value</span><span class="kw">]</span></span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a>            <span class="kw">}</span></span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Basic serializers</span></span>
<span id="cb21-52"><a href="#cb21-52" aria-hidden="true" tabindex="-1"></a>    :protected method toString <span class="kw">{</span>value<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb21-53"><a href="#cb21-53" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> <span class="dt">$value</span></span>
<span id="cb21-54"><a href="#cb21-54" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb21-55"><a href="#cb21-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-56"><a href="#cb21-56" aria-hidden="true" tabindex="-1"></a>    :protected method fromString <span class="kw">{</span>value<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb21-57"><a href="#cb21-57" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> <span class="dt">$value</span></span>
<span id="cb21-58"><a href="#cb21-58" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb21-59"><a href="#cb21-59" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-60"><a href="#cb21-60" aria-hidden="true" tabindex="-1"></a>    :protected method toList <span class="kw">{</span>value<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb21-61"><a href="#cb21-61" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> <span class="dt">$value</span></span>
<span id="cb21-62"><a href="#cb21-62" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb21-63"><a href="#cb21-63" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-64"><a href="#cb21-64" aria-hidden="true" tabindex="-1"></a>    :protected method fromList <span class="kw">{</span>value<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb21-65"><a href="#cb21-65" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> <span class="dt">$value</span></span>
<span id="cb21-66"><a href="#cb21-66" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb21-67"><a href="#cb21-67" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-68"><a href="#cb21-68" aria-hidden="true" tabindex="-1"></a>    :protected method toDict <span class="kw">{</span>value<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb21-69"><a href="#cb21-69" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> <span class="dt">$value</span></span>
<span id="cb21-70"><a href="#cb21-70" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb21-71"><a href="#cb21-71" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-72"><a href="#cb21-72" aria-hidden="true" tabindex="-1"></a>    :protected method fromDict <span class="kw">{</span>value<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb21-73"><a href="#cb21-73" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> <span class="dt">$value</span></span>
<span id="cb21-74"><a href="#cb21-74" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb21-75"><a href="#cb21-75" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>How custom serialization works: 1. Objects define serializable
variables 2. Each variable has a type 3. Types have serializers 4.
Serialization is extensible 5. Supports custom formats</p>
<p>Example usage:</p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode tcl"><code class="sourceCode tcl"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a serializable class</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>nx::Class <span class="ot">create</span> Person<span class="ot"> -mixin</span> Serializable <span class="kw">{</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    :property <span class="ot">name</span>:<span class="kw">string</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    :property age:integer</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    :property address:<span class="kw">dict</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    :property tags:<span class="kw">list</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    :public method init <span class="kw">{}</span> <span class="kw">{</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>        next</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Register serializable vars</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>        :addSerializableVar <span class="ot">name</span> <span class="kw">string</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>        :addSerializableVar age <span class="kw">string</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>        :addSerializableVar address <span class="kw">dict</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>        :addSerializableVar tags <span class="kw">list</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Create and serialize object</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> person <span class="kw">[</span>Person new<span class="kw">]</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> :<span class="ot">name</span> <span class="st">&quot;John Doe&quot;</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> :age <span class="dv">30</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> :address <span class="kw">[dict</span> <span class="ot">create</span> street <span class="st">&quot;123 Main St&quot;</span> city <span class="st">&quot;Anytown&quot;</span><span class="kw">]</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> :tags <span class="kw">[list</span> <span class="st">&quot;employee&quot;</span> <span class="st">&quot;manager&quot;</span><span class="kw">]</span></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Serialize</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> data <span class="kw">[</span><span class="dt">$person</span> serialize<span class="kw">]</span></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Create new object and deserialize</span></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> person2 <span class="kw">[</span>Person new<span class="kw">]</span></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a><span class="dt">$person2</span> deserialize <span class="dt">$data</span></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify</span></span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a><span class="kw">puts</span> <span class="kw">[</span><span class="dt">$person2</span> <span class="ot">cget -name</span><span class="kw">]</span>  ;<span class="co"># Outputs: John Doe</span></span></code></pre></div>
<h2 id="best-practices-for-nx-extensions">5. Best Practices for NX
Extensions</h2>
<h3 id="method-extensions-best-practices">Method Extensions Best
Practices</h3>
<ol type="1">
<li>Protection Levels
<ul>
<li>Use appropriate protection levels for methods</li>
<li>Make internal methods protected</li>
<li>Only expose necessary public interface</li>
<li>Consider using private for implementation details</li>
</ul></li>
</ol>
<div class="sourceCode" id="cb23"><pre
class="sourceCode tcl"><code class="sourceCode tcl"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>nx::Class <span class="ot">create</span> BestPracticeExample <span class="kw">{</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Public API methods</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    :public method doSomething <span class="kw">{</span>arg<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Validate input</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>        :validateInput <span class="dt">$arg</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Perform operation</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">set</span> result <span class="kw">[</span>:processData <span class="dt">$arg</span><span class="kw">]</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Post-process</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> <span class="kw">[</span>:formatResult <span class="dt">$result</span><span class="kw">]</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Protected internal methods</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    :protected method validateInput <span class="kw">{</span>arg<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="kw">{</span>!<span class="kw">[string</span> <span class="ot">is</span> double<span class="ot"> -strict</span> <span class="dt">$arg</span><span class="kw">]}</span> <span class="kw">{</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>            <span class="kw">error</span> <span class="st">&quot;Invalid input: must be number&quot;</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>    :protected method processData <span class="kw">{</span>arg<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Internal processing</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> <span class="kw">[expr</span> <span class="kw">{</span><span class="dt">$arg</span> * <span class="dv">2</span><span class="kw">}]</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Private implementation details</span></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>    :private method formatResult <span class="kw">{</span>result<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>        <span class="kw">format</span> <span class="st">&quot;%.2f&quot;</span> <span class="dt">$result</span></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<ol start="2" type="1">
<li>Method Documentation
<ul>
<li>Document method contracts clearly</li>
<li>Specify parameter types and constraints</li>
<li>Document exceptions that may be thrown</li>
<li>Include usage examples</li>
</ul></li>
</ol>
<div class="sourceCode" id="cb24"><pre
class="sourceCode tcl"><code class="sourceCode tcl"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>nx::Class <span class="ot">create</span> DocumentedClass <span class="kw">{</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Method documentation</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    :public method processTransaction <span class="kw">{</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>        amount:double</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>        -account:<span class="kw">string</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>        -<span class="ot">type</span>:<span class="kw">string</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Amount: Transaction amount (positive for credit, negative for debit)</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># -account: Account identifier</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># -type: Transaction type (deposit|withdrawal|transfer)</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Returns: Transaction ID</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Throws: INVALID_AMOUNT, ACCOUNT_NOT_FOUND, INSUFFICIENT_FUNDS</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Implementation...</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<ol start="3" type="1">
<li>Error Handling
<ul>
<li>Use structured error handling</li>
<li>Create custom error types</li>
<li>Provide detailed error messages</li>
<li>Clean up resources in error cases</li>
</ul></li>
</ol>
<div class="sourceCode" id="cb25"><pre
class="sourceCode tcl"><code class="sourceCode tcl"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>nx::Class <span class="ot">create</span> ErrorHandling <span class="kw">{</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    :public method safeOperation <span class="kw">{}</span> <span class="kw">{</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Setup</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>        :acquireResources</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>        try <span class="kw">{</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Perform operation</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>            :doOperation</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span> trap <span class="kw">{</span>OPERATION FAILED<span class="kw">}</span> <span class="kw">{</span>err<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Handle specific error</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>            :logError <span class="dt">$err</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>            :notifyAdmin <span class="dt">$err</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>            <span class="kw">error</span> <span class="st">&quot;Operation failed: </span><span class="dt">$</span><span class="st">err&quot;</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span> finally <span class="kw">{</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Always clean up</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>            :releaseResources</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<h3 id="type-system-extensions-best-practices">Type System Extensions
Best Practices</h3>
<ol type="1">
<li>Type Validation
<ul>
<li>Validate input thoroughly</li>
<li>Handle edge cases</li>
<li>Convert types safely</li>
<li>Maintain type consistency</li>
</ul></li>
</ol>
<div class="sourceCode" id="cb26"><pre
class="sourceCode tcl"><code class="sourceCode tcl"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a robust type</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>::nsf::<span class="ot">type</span>::<span class="ot">create</span> email <span class="kw">{</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    -<span class="ot">validate</span> <span class="kw">{</span>value<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Thorough validation</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="kw">{</span>!<span class="kw">[regexp</span> <span class="kw">{</span>^<span class="kw">[</span>a-zA-Z0<span class="fl">-9.</span>_%+-<span class="kw">]</span>+@<span class="kw">[</span>a-zA-Z0<span class="fl">-9.</span>-<span class="kw">]</span>+<span class="ch">\.</span><span class="kw">[</span>a-zA-Z<span class="kw">]{</span><span class="dv">2</span>,<span class="kw">}</span>$<span class="kw">}</span> <span class="dt">$value</span><span class="kw">]}</span> <span class="kw">{</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>            <span class="kw">error</span> <span class="st">&quot;Invalid email format&quot;</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Additional checks</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="kw">{[string</span> <span class="ot">length</span> <span class="dt">$value</span><span class="kw">]</span> &gt; <span class="dv">254</span><span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>            <span class="kw">error</span> <span class="st">&quot;Email too long&quot;</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Normalize</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> <span class="kw">[string</span> <span class="ot">tolower</span> <span class="dt">$value</span><span class="kw">]</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<ol start="2" type="1">
<li>Performance Considerations
<ul>
<li>Cache validation results</li>
<li>Optimize frequent operations</li>
<li>Use efficient data structures</li>
<li>Profile type checkers</li>
</ul></li>
</ol>
<div class="sourceCode" id="cb27"><pre
class="sourceCode tcl"><code class="sourceCode tcl"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>nx::Class <span class="ot">create</span> CachedTypeChecker <span class="kw">{</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    :property <span class="kw">{</span>cache:<span class="kw">dict</span> <span class="kw">{}}</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    :property <span class="kw">{</span>cacheSize <span class="dv">1000</span><span class="kw">}</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    :public method validateType <span class="kw">{</span>value <span class="ot">type</span><span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Check cache</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">set</span> key <span class="st">&quot;</span><span class="dt">$</span><span class="st">value,</span><span class="dt">$</span><span class="st">type&quot;</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="kw">{[dict</span> <span class="ot">exists</span> <span class="dt">${:cache}</span> <span class="dt">$key</span><span class="kw">]}</span> <span class="kw">{</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span> <span class="kw">[dict</span> <span class="ot">get</span> <span class="dt">${:cache}</span> <span class="dt">$key</span><span class="kw">]</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Perform validation</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">set</span> result <span class="kw">[</span>:performValidation <span class="dt">$value</span> <span class="dt">$type</span><span class="kw">]</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Update cache</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>        :updateCache <span class="dt">$key</span> <span class="dt">$result</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> <span class="dt">$result</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>    :protected method updateCache <span class="kw">{</span>key value<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Maintain cache size</span></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="kw">{[dict</span> <span class="ot">size</span> <span class="dt">${:cache}</span><span class="kw">]</span> &gt;= <span class="dt">${:cacheSize}</span><span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>            <span class="kw">set</span> oldest <span class="kw">[lindex</span> <span class="kw">[dict</span> <span class="ot">keys</span> <span class="dt">${:cache}</span><span class="kw">]</span> <span class="dv">0</span><span class="kw">]</span></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>            <span class="kw">dict</span> <span class="kw">unset</span> :cache <span class="dt">$oldest</span></span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>        <span class="kw">dict</span> <span class="kw">set</span> :cache <span class="dt">$key</span> <span class="dt">$value</span></span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<h3 id="meta-programming-best-practices">Meta-Programming Best
Practices</h3>
<ol type="1">
<li>Code Generation
<ul>
<li>Generate clean, readable code</li>
<li>Include comments in generated code</li>
<li>Handle namespaces properly</li>
<li>Validate generated code</li>
</ul></li>
</ol>
<div class="sourceCode" id="cb28"><pre
class="sourceCode tcl"><code class="sourceCode tcl"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>nx::Class <span class="ot">create</span> CodeGenerator <span class="kw">{</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    :public method generateAccessors <span class="kw">{</span><span class="ot">class</span> properties<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">set</span> code <span class="st">&quot;&quot;</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">foreach</span> prop <span class="dt">$properties</span> <span class="kw">{</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>            <span class="kw">append</span> code <span class="st">&quot;    # Accessor for </span><span class="dt">$</span><span class="st">prop</span><span class="ch">\n</span><span class="st">&quot;</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>            <span class="kw">append</span> code <span class="st">&quot;    :public method get[string totitle </span><span class="dt">$</span><span class="st">prop] {} {</span><span class="ch">\n</span><span class="st">&quot;</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>            <span class="kw">append</span> code <span class="st">&quot;        return </span><span class="ch">\$</span><span class="st">{:</span><span class="dt">$</span><span class="st">prop}</span><span class="ch">\n</span><span class="st">&quot;</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>            <span class="kw">append</span> code <span class="st">&quot;    }</span><span class="ch">\n\n</span><span class="st">&quot;</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>            <span class="kw">append</span> code <span class="st">&quot;    # Mutator for </span><span class="dt">$</span><span class="st">prop</span><span class="ch">\n</span><span class="st">&quot;</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>            <span class="kw">append</span> code <span class="st">&quot;    :public method set[string totitle </span><span class="dt">$</span><span class="st">prop] {value} {</span><span class="ch">\n</span><span class="st">&quot;</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>            <span class="kw">append</span> code <span class="st">&quot;        set :</span><span class="dt">$</span><span class="st">prop </span><span class="ch">\$</span><span class="st">value</span><span class="ch">\n</span><span class="st">&quot;</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>            <span class="kw">append</span> code <span class="st">&quot;    }</span><span class="ch">\n\n</span><span class="st">&quot;</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> <span class="dt">$code</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<ol start="2" type="1">
<li>Resource Management
<ul>
<li>Clean up generated resources</li>
<li>Handle circular references</li>
<li>Manage memory efficiently</li>
<li>Use weak references when appropriate</li>
</ul></li>
</ol>
<div class="sourceCode" id="cb29"><pre
class="sourceCode tcl"><code class="sourceCode tcl"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>nx::Class <span class="ot">create</span> ResourceManager <span class="kw">{</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    :property <span class="kw">{</span>resources:<span class="kw">dict</span> <span class="kw">{}}</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    :property <span class="kw">{</span>weakRefs:<span class="kw">dict</span> <span class="kw">{}}</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    :public method trackResource <span class="kw">{resource}</span> <span class="kw">{</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Store strong reference</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">dict</span> <span class="kw">set</span> :resources <span class="kw">[</span><span class="dt">$resource</span> <span class="ot">name</span><span class="kw">]</span> <span class="dt">$resource</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Setup cleanup</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">$resource</span> public method <span class="kw">destroy</span> <span class="kw">{}</span> <span class="kw">{</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>            next</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>            :cleanupResource <span class="kw">[</span>self<span class="kw">]</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>    :public method weakRef <span class="kw">{resource}</span> <span class="kw">{</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Store weak reference</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>        <span class="kw">dict</span> <span class="kw">set</span> :weakRefs <span class="kw">[</span><span class="dt">$resource</span> <span class="ot">name</span><span class="kw">]</span> <span class="dt">$resource</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>        <span class="kw">trace</span> <span class="ot">add</span> <span class="kw">variable</span> :weakRefs write <span class="kw">[</span>:cleanupWeakRef <span class="dt">$resource</span><span class="kw">]</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<h3 id="testing-extensions-best-practices">Testing Extensions Best
Practices</h3>
<ol type="1">
<li>Test Coverage
<ul>
<li>Test normal cases</li>
<li>Test edge cases</li>
<li>Test error conditions</li>
<li>Test performance</li>
</ul></li>
</ol>
<div class="sourceCode" id="cb30"><pre
class="sourceCode tcl"><code class="sourceCode tcl"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>nx::Class <span class="ot">create</span> TestCase <span class="kw">{</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    :public method assert <span class="kw">{</span>condition <span class="kw">{message</span> <span class="st">&quot;&quot;</span><span class="kw">}}</span> <span class="kw">{</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="kw">{</span>!<span class="kw">[uplevel</span> <span class="dv">1</span> <span class="kw">[list</span> <span class="kw">expr</span> <span class="dt">$condition</span><span class="kw">]]}</span> <span class="kw">{</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>            <span class="kw">error</span> <span class="st">&quot;Assertion failed: </span><span class="dt">$</span><span class="st">message&quot;</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    :public method assertThrows <span class="kw">{</span><span class="ot">script</span> <span class="kw">errorCode}</span> <span class="kw">{</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="kw">{[catch</span> <span class="kw">{uplevel</span> <span class="dv">1</span> <span class="dt">$script</span><span class="kw">}</span> result opts<span class="kw">]}</span> <span class="kw">{</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>            <span class="kw">set</span> actualError <span class="kw">[dict</span> <span class="ot">get</span> <span class="dt">$opts</span><span class="ot"> -errorcode</span><span class="kw">]</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="kw">{</span><span class="dt">$actualError</span> ne <span class="dt">$errorCode</span><span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>                <span class="kw">error</span> <span class="st">&quot;Expected error </span><span class="dt">$</span><span class="st">errorCode but got </span><span class="dt">$</span><span class="st">actualError&quot;</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>            <span class="kw">}</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span> <span class="kw">else</span> <span class="kw">{</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>            <span class="kw">error</span> <span class="st">&quot;Expected error </span><span class="dt">$</span><span class="st">errorCode but no error occurred&quot;</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>    :public method benchmark <span class="kw">{</span><span class="ot">script</span> <span class="kw">{</span>iterations <span class="dv">1000</span><span class="kw">}}</span> <span class="kw">{</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>        <span class="kw">set</span> start <span class="kw">[clock</span> microseconds<span class="kw">]</span></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>        <span class="kw">for</span> <span class="kw">{set</span> i <span class="dv">0</span><span class="kw">}</span> <span class="kw">{</span><span class="dt">$i</span> &lt; <span class="dt">$iterations</span><span class="kw">}</span> <span class="kw">{incr</span> i<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>            <span class="kw">uplevel</span> <span class="dv">1</span> <span class="dt">$script</span></span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>        <span class="kw">set</span> end <span class="kw">[clock</span> microseconds<span class="kw">]</span></span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> <span class="kw">[expr</span> <span class="kw">{</span>(<span class="dt">$end</span> - <span class="dt">$start</span>) / <span class="dt">$iterations</span><span class="fl">.0</span><span class="kw">}]</span></span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Usage</span></span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>nx::Class <span class="ot">create</span> MyExtensionTest<span class="ot"> -superclass</span> TestCase <span class="kw">{</span></span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>    :public method testFeature <span class="kw">{}</span> <span class="kw">{</span></span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Test normal case</span></span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>        :assert <span class="kw">{[</span>MyClass new<span class="kw">]</span> ne <span class="st">&quot;&quot;</span><span class="kw">}</span> <span class="st">&quot;Object creation&quot;</span></span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Test edge case</span></span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a>        :assert <span class="kw">{[</span>MyClass new<span class="ot"> -value</span> <span class="st">&quot;&quot;</span><span class="kw">]</span> ne <span class="st">&quot;&quot;</span><span class="kw">}</span> <span class="st">&quot;Empty value&quot;</span></span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Test error</span></span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a>        :assertThrows <span class="kw">{</span></span>
<span id="cb30-41"><a href="#cb30-41" aria-hidden="true" tabindex="-1"></a>            MyClass new<span class="ot"> -invalid</span> value</span>
<span id="cb30-42"><a href="#cb30-42" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span> <span class="kw">{</span>INVALID PARAMETER<span class="kw">}</span></span>
<span id="cb30-43"><a href="#cb30-43" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-44"><a href="#cb30-44" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Test performance</span></span>
<span id="cb30-45"><a href="#cb30-45" aria-hidden="true" tabindex="-1"></a>        <span class="kw">set</span> <span class="kw">time</span> <span class="kw">[</span>:benchmark <span class="kw">{</span>MyClass new<span class="kw">}]</span></span>
<span id="cb30-46"><a href="#cb30-46" aria-hidden="true" tabindex="-1"></a>        :assert <span class="kw">{</span><span class="dt">$time</span> &lt; <span class="dv">1000</span><span class="kw">}</span> <span class="st">&quot;Performance check&quot;</span></span>
<span id="cb30-47"><a href="#cb30-47" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb30-48"><a href="#cb30-48" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<ol start="2" type="1">
<li>Test Organization
<ul>
<li>Group related tests</li>
<li>Use descriptive test names</li>
<li>Setup and teardown properly</li>
<li>Isolate test cases</li>
</ul></li>
</ol>
<div class="sourceCode" id="cb31"><pre
class="sourceCode tcl"><code class="sourceCode tcl"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>nx::Class <span class="ot">create</span> TestSuite <span class="kw">{</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    :property <span class="kw">{</span>tests:<span class="kw">dict</span> <span class="kw">{}}</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    :property <span class="kw">{</span>results:<span class="kw">dict</span> <span class="kw">{}}</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    :public method addTest <span class="kw">{</span><span class="ot">name</span> <span class="ot">script</span><span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">dict</span> <span class="kw">set</span> :tests <span class="dt">$name</span> <span class="dt">$script</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    :public method setup <span class="kw">{}</span> <span class="kw">{</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Setup test environment</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>    :public method teardown <span class="kw">{}</span> <span class="kw">{</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Clean up test environment</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>    :public method runTests <span class="kw">{}</span> <span class="kw">{</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>        :setup</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>        <span class="kw">dict</span> <span class="kw">for</span> <span class="kw">{</span><span class="ot">name</span> <span class="ot">script</span><span class="kw">}</span> <span class="dt">${:tests}</span> <span class="kw">{</span></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>            try <span class="kw">{</span></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>                <span class="kw">uplevel</span> <span class="dv">1</span> <span class="dt">$script</span></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>                <span class="kw">dict</span> <span class="kw">set</span> :results <span class="dt">$name</span> <span class="st">&quot;PASS&quot;</span></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>            <span class="kw">}</span> trap <span class="kw">{</span>ASSERT FAILED<span class="kw">}</span> <span class="kw">{</span>err<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>                <span class="kw">dict</span> <span class="kw">set</span> :results <span class="dt">$name</span> <span class="st">&quot;FAIL: </span><span class="dt">$</span><span class="st">err&quot;</span></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>            <span class="kw">}</span> finally <span class="kw">{</span></span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>                :teardown</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>            <span class="kw">}</span></span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>        :reportResults</span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>These best practices help ensure that your NX extensions are: -
Reliable and maintainable - Performant and efficient - Well-tested and
documented - Easy to use and understand - Follow consistent patterns</p>
<h2 id="slot-based-programming">6. Slot-Based Programming</h2>
<p>Slots are a fundamental concept in NX that provide a powerful way to
define and manage object attributes and behavior. They offer more
flexibility and control than traditional properties.</p>
<h3 id="slot-basics">Slot Basics</h3>
<p>Slots in NX are containers for values with associated metadata and
behavior. They can: 1. Hold values of any type 2. Have custom access
methods 3. Trigger behavior on access/modification 4. Support validation
and type checking 5. Maintain per-instance metadata</p>
<div class="sourceCode" id="cb32"><pre
class="sourceCode tcl"><code class="sourceCode tcl"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a class with slots</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>nx::Class <span class="ot">create</span> SlotExample <span class="kw">{</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define a basic slot</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    :slot <span class="ot">x</span> <span class="kw">{</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>        :<span class="ot">type</span> integer</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>        :<span class="ot">default</span> <span class="dv">0</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define a slot with custom accessors</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>    :slot <span class="ot">y</span> <span class="kw">{</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>        :accessor public</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>        :writer private</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>        :<span class="ot">type</span> double</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>        :<span class="ot">default</span> <span class="fl">0.0</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Custom getter</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>        :getter <span class="kw">{</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>            <span class="kw">expr</span> <span class="kw">{</span><span class="dt">${:y}</span> * <span class="dv">2</span><span class="kw">}</span>  ;<span class="co"># Always return double the stored value</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Custom setter with validation</span></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>        :setter <span class="kw">{</span>value<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="kw">{</span><span class="dt">$value</span> &lt; <span class="dv">0</span><span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>                <span class="kw">error</span> <span class="st">&quot;Y cannot be negative&quot;</span></span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>            <span class="kw">}</span></span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>            <span class="kw">set</span> :<span class="ot">y</span> <span class="dt">$value</span></span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Slot with notifications</span></span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>    :slot <span class="ot">status</span> <span class="kw">{</span></span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a>        :<span class="ot">type</span> <span class="kw">string</span></span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a>        :<span class="ot">default</span> <span class="st">&quot;inactive&quot;</span></span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Notify on changes</span></span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a>        :notifier <span class="kw">{</span>old new<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a>            <span class="kw">puts</span> <span class="st">&quot;Status changed from </span><span class="dt">$</span><span class="st">old to </span><span class="dt">$</span><span class="st">new&quot;</span></span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>How slots work: 1. Slots are defined at class creation 2. Each slot
can have: - Type constraints - Default values - Custom accessors -
Validation logic - Change notifications 3. Slots are inherited by
subclasses 4. Slots can be modified at runtime</p>
<h3 id="advanced-slot-features">Advanced Slot Features</h3>
<h4 id="computed-slots">Computed Slots</h4>
<p>Computed slots derive their values from other slots or
computations:</p>
<div class="sourceCode" id="cb33"><pre
class="sourceCode tcl"><code class="sourceCode tcl"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>nx::Class <span class="ot">create</span> Point <span class="kw">{</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    :slot <span class="ot">x</span>:double</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    :slot <span class="ot">y</span>:double</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Computed slot for radius (read-only)</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    :slot radius <span class="kw">{</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>        :computed</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>        :getter <span class="kw">{</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>            <span class="kw">expr</span> <span class="kw">{</span>sqrt(<span class="dt">${:x}</span>*<span class="dt">${:x}</span> + <span class="dt">${:y}</span>*<span class="dt">${:y}</span>)<span class="kw">}</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Computed slot with custom setter</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>    :slot angle <span class="kw">{</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>        :computed</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>        :getter <span class="kw">{</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>            <span class="kw">expr</span> <span class="kw">{</span>atan2(<span class="dt">${:y}</span>, <span class="dt">${:x}</span>)<span class="kw">}</span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>        :setter <span class="kw">{</span>value<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>            <span class="kw">set</span> r <span class="dt">${:radius}</span></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>            <span class="kw">set</span> :<span class="ot">x</span> <span class="kw">[expr</span> <span class="kw">{</span><span class="dt">$r</span> * cos(<span class="dt">$value</span>)<span class="kw">}]</span></span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>            <span class="kw">set</span> :<span class="ot">y</span> <span class="kw">[expr</span> <span class="kw">{</span><span class="dt">$r</span> * sin(<span class="dt">$value</span>)<span class="kw">}]</span></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<h4 id="slot-introspection">Slot Introspection</h4>
<p>Slots support rich introspection capabilities:</p>
<div class="sourceCode" id="cb34"><pre
class="sourceCode tcl"><code class="sourceCode tcl"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>nx::Class <span class="ot">create</span> IntrospectableClass <span class="kw">{</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>    :slot config <span class="kw">{</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>        :<span class="ot">type</span> <span class="kw">dict</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>        :<span class="ot">default</span> <span class="kw">{}</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>        :<span class="kw">trace</span> <span class="kw">{</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>            :<span class="kw">read</span> <span class="kw">{</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>                <span class="kw">puts</span> <span class="st">&quot;Reading config&quot;</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>            <span class="kw">}</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>            :write <span class="kw">{</span>old new<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>                <span class="kw">puts</span> <span class="st">&quot;Config changed from </span><span class="dt">$</span><span class="st">old to </span><span class="dt">$</span><span class="st">new&quot;</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>            <span class="kw">}</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>    :public method inspectSlots <span class="kw">{}</span> <span class="kw">{</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get all slots</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>        <span class="kw">set</span> slots <span class="kw">[list]</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>        <span class="kw">foreach</span> slot <span class="kw">[</span>:<span class="kw">info</span> slots<span class="kw">]</span> <span class="kw">{</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>            <span class="kw">lappend</span> slots <span class="kw">[list</span> \</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>                <span class="dt">$slot</span> \</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>                <span class="kw">[</span>:<span class="kw">info</span> slot <span class="ot">type</span> <span class="dt">$slot</span><span class="kw">]</span> \</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>                <span class="kw">[</span>:<span class="kw">info</span> slot <span class="ot">default</span> <span class="dt">$slot</span><span class="kw">]</span> \</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>                <span class="kw">[</span>:<span class="kw">info</span> slot options <span class="dt">$slot</span><span class="kw">]</span></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>            <span class="kw">]</span></span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> <span class="dt">$slots</span></span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<h3 id="slot-based-design-patterns">Slot-Based Design Patterns</h3>
<h4 id="observable-properties">Observable Properties</h4>
<p>Use slots to implement the observer pattern:</p>
<div class="sourceCode" id="cb35"><pre
class="sourceCode tcl"><code class="sourceCode tcl"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>nx::Class <span class="ot">create</span> Observable <span class="kw">{</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    :slot observers:<span class="kw">list</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    :public method addObserver <span class="kw">{</span>observer<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lappend</span> :observers <span class="dt">$observer</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>    :public method removeObserver <span class="kw">{</span>observer<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">set</span> idx <span class="kw">[lsearch</span> <span class="dt">${:observers}</span> <span class="dt">$observer</span><span class="kw">]</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="kw">{</span><span class="dt">$idx</span> &gt;= <span class="dv">0</span><span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>            <span class="kw">set</span> :observers <span class="kw">[lreplace</span> <span class="dt">${:observers}</span> <span class="dt">$idx</span> <span class="dt">$idx</span><span class="kw">]</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>    :protected method notifyObservers <span class="kw">{event</span> <span class="ot">args</span><span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">foreach</span> observer <span class="dt">${:observers}</span> <span class="kw">{</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="kw">{[</span><span class="dt">$observer</span> <span class="kw">info</span> methods <span class="dt">$event</span><span class="kw">]</span> ne <span class="st">&quot;&quot;</span><span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>                <span class="dt">$observer</span> <span class="dt">$event</span> <span class="kw">{</span>*<span class="kw">}</span><span class="dt">$args</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>            <span class="kw">}</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>nx::Class <span class="ot">create</span> Temperature<span class="ot"> -superclass</span> Observable <span class="kw">{</span></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>    :slot celsius <span class="kw">{</span></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>        :<span class="ot">type</span> double</span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>        :<span class="ot">default</span> <span class="fl">20.0</span></span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>        :notifier <span class="kw">{</span>old new<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>            :notifyObservers temperatureChanged <span class="dt">$old</span> <span class="dt">$new</span></span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a>    :slot fahrenheit <span class="kw">{</span></span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a>        :computed</span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a>        :getter <span class="kw">{</span></span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a>            <span class="kw">expr</span> <span class="kw">{</span><span class="dt">${:celsius}</span> * <span class="fl">1.8</span> + <span class="dv">32</span><span class="kw">}</span></span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a>        :setter <span class="kw">{</span>value<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a>            <span class="kw">set</span> :celsius <span class="kw">[expr</span> <span class="kw">{</span>(<span class="dt">$value</span> - <span class="dv">32</span>) / <span class="fl">1.8</span><span class="kw">}]</span></span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<h4 id="validation-and-constraints">Validation and Constraints</h4>
<p>Use slots to implement complex validation:</p>
<div class="sourceCode" id="cb36"><pre
class="sourceCode tcl"><code class="sourceCode tcl"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>nx::Class <span class="ot">create</span> ValidatedRecord <span class="kw">{</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Slot with multiple constraints</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    :slot age <span class="kw">{</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>        :<span class="ot">type</span> integer</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>        :<span class="ot">default</span> <span class="dv">0</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>        :constraint <span class="kw">{</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>            <span class="kw">{</span>value<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>                <span class="kw">expr</span> <span class="kw">{</span><span class="dt">$value</span> &gt;= <span class="dv">0</span><span class="kw">}</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>            <span class="kw">}</span> <span class="st">&quot;Age must be non-negative&quot;</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>            <span class="kw">{</span>value<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>                <span class="kw">expr</span> <span class="kw">{</span><span class="dt">$value</span> &lt;= <span class="dv">150</span><span class="kw">}</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>            <span class="kw">}</span> <span class="st">&quot;Age must be reasonable&quot;</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Slot with dependent validation</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>    :slot dateRange <span class="kw">{</span></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>        :<span class="ot">type</span> <span class="kw">dict</span></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>        :<span class="ot">default</span> <span class="kw">{</span>start <span class="st">&quot;&quot;</span> end <span class="st">&quot;&quot;</span><span class="kw">}</span></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>        :constraint <span class="kw">{</span></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>            <span class="kw">{</span>value<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>                <span class="kw">set</span> start <span class="kw">[dict</span> <span class="ot">get</span> <span class="dt">$value</span> start<span class="kw">]</span></span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>                <span class="kw">set</span> end <span class="kw">[dict</span> <span class="ot">get</span> <span class="dt">$value</span> end<span class="kw">]</span></span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> <span class="kw">{</span><span class="dt">$start</span> eq <span class="st">&quot;&quot;</span> || <span class="dt">$end</span> eq <span class="st">&quot;&quot;</span><span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">return</span> <span class="dv">1</span></span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>                <span class="kw">}</span></span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>                <span class="kw">clock</span> <span class="kw">scan</span> <span class="dt">$start</span></span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>                <span class="kw">clock</span> <span class="kw">scan</span> <span class="dt">$end</span></span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>                <span class="kw">expr</span> <span class="kw">{[clock</span> <span class="kw">scan</span> <span class="dt">$start</span><span class="kw">]</span> &lt;= <span class="kw">[clock</span> <span class="kw">scan</span> <span class="dt">$end</span><span class="kw">]}</span></span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>            <span class="kw">}</span> <span class="st">&quot;End date must be after start date&quot;</span></span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<h3 id="best-practices-for-slots">Best Practices for Slots</h3>
<ol type="1">
<li>Use Slots for Complex Properties
<ul>
<li>When you need validation</li>
<li>When you need computed values</li>
<li>When you need change notification</li>
<li>When you need custom access control</li>
</ul></li>
<li>Slot Design Guidelines
<ul>
<li>Keep slot definitions clear and focused</li>
<li>Use appropriate types and constraints</li>
<li>Document slot behavior and requirements</li>
<li>Consider inheritance implications</li>
</ul></li>
<li>Performance Considerations
<ul>
<li>Use computed slots judiciously</li>
<li>Cache complex computations</li>
<li>Minimize notification overhead</li>
<li>Profile slot access patterns</li>
</ul></li>
</ol>
<p>Example of well-designed slots:</p>
<div class="sourceCode" id="cb37"><pre
class="sourceCode tcl"><code class="sourceCode tcl"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>nx::Class <span class="ot">create</span> Account <span class="kw">{</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Simple value slot</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    :slot <span class="ot">id</span>:<span class="kw">string</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Validated slot with constraints</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    :slot balance <span class="kw">{</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>        :<span class="ot">type</span> double</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>        :<span class="ot">default</span> <span class="fl">0.0</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>        :constraint <span class="kw">{</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>            <span class="kw">{</span>value<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>                <span class="kw">expr</span> <span class="kw">{</span><span class="dt">$value</span> &gt;= <span class="dv">0</span><span class="kw">}</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>            <span class="kw">}</span> <span class="st">&quot;Balance cannot be negative&quot;</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Computed slot with caching</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>    :slot interestRate <span class="kw">{</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>        :computed</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>        :cache <span class="dv">1</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>        :getter <span class="kw">{</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Complex computation that gets cached</span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>            :computeInterestRate <span class="dt">${:balance}</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Slot with custom access control</span></span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>    :slot transactions <span class="kw">{</span></span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>        :<span class="ot">type</span> <span class="kw">list</span></span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>        :<span class="ot">default</span> <span class="kw">{}</span></span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>        :accessor public</span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>        :writer private</span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Maintain transaction history</span></span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a>        :setter <span class="kw">{</span>value<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a>            <span class="kw">set</span> :transactions <span class="kw">[lrange</span> <span class="dt">$value</span> end<span class="dv">-99</span> end<span class="kw">]</span></span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Slot with notifications</span></span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a>    :slot <span class="ot">status</span> <span class="kw">{</span></span>
<span id="cb37-41"><a href="#cb37-41" aria-hidden="true" tabindex="-1"></a>        :<span class="ot">type</span> <span class="kw">string</span></span>
<span id="cb37-42"><a href="#cb37-42" aria-hidden="true" tabindex="-1"></a>        :<span class="ot">default</span> <span class="st">&quot;active&quot;</span></span>
<span id="cb37-43"><a href="#cb37-43" aria-hidden="true" tabindex="-1"></a>        :notifier <span class="kw">{</span>old new<span class="kw">}</span> <span class="kw">{</span></span>
<span id="cb37-44"><a href="#cb37-44" aria-hidden="true" tabindex="-1"></a>            :logStatusChange <span class="dt">$old</span> <span class="dt">$new</span></span>
<span id="cb37-45"><a href="#cb37-45" aria-hidden="true" tabindex="-1"></a>            :notifyStatusObservers <span class="dt">$old</span> <span class="dt">$new</span></span>
<span id="cb37-46"><a href="#cb37-46" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb37-47"><a href="#cb37-47" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb37-48"><a href="#cb37-48" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>This demonstrates how slots provide a powerful mechanism for: - Value
management - Computed properties - Validation - Change notification -
Access control - Introspection</p>
</body>
</html>
